buildscript {
	repositories {
		maven { url "${artifactory_url}/libs-release" }
	}
	dependencies {
		classpath "org.raml:raml-jaxrs-codegen-core:1.3.4"
		classpath "org.springframework.boot:spring-boot-gradle-plugin:${version_spring_boot}"
		classpath "org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:2.2.1"
	}
}


defaultTasks "clean", "run"


subprojects {

	repositories {
		maven { url "${artifactory_url}/libs-release" }
		maven { url "${artifactory_url}/third-party" }
	}


	configurations {
	
		// global exclusions	
		compile.exclude module: "commons-logging"
		compile.exclude module: "log4j"
		compile.exclude module: "c3p0"
		compile.exclude module: "tomcat-embed-core"
		compile.exclude module: "tomcat-embed-el"
		compile.exclude module: "tomcat-embed-websocket"
		compile.exclude module: "tomcat-juli"
		compile.exclude module: "tomcat-jdbc"
		compile.exclude module: "spring-boot-starter-tomcat"
		compile.exclude module: "tools"

		integrationTestCompile.extendsFrom testCompile
		integrationTestRuntime.extendsFrom testRuntime
	}

	apply plugin: "java"
	apply plugin: "org.sonarqube"
	apply plugin: "checkstyle"
	apply plugin: "maven"
	apply plugin: "maven-publish"
	apply plugin: "idea"
	apply plugin: "eclipse"
	apply plugin: "org.springframework.boot"

	
	sourceCompatibility = JavaVersion.VERSION_1_8
	targetCompatibility = JavaVersion.VERSION_1_8	

	group = "net.syscon.elite"
	version = "1.0-SNAPSHOT"
	
	sonarqube {
		properties {
			property "sonar.projectName", "Elite2"
			property "sonar.projectKey", "net.syscon.elite:elite2"
			property "sonar.sourceEncoding", "UTF-8"
			property "sonar.login", "e73c987cc6cad28be858a8610636c1d2545c4c96"
			property "sonar.host.url", "http://chronos.syscon.ca:9000/sonar"
			property "sonar.sources", "src/main/java"
			property "sonar.exclusions", "**/generated/**"
		}
	}	
	
	dependencies {
		compile( "org.apache.commons:commons-lang3:3.5")
		compile("com.google.code.findbugs:jsr305:3.0.1")
	}

	install.repositories.mavenInstaller.pom.whenConfigured { generatedPom ->
		generatedPom.project {
			name = project.name
			description = project.description
			url "http://www.syscon.net"
			organization { name "Syscon Justice Systems"; url "http://www.syscon.net" }
			developers {
				developer {
					id "syscon-elite-team"
					name "Syscon Elite Team"
					organization  "Syscon Justice Systems"
					organizationUrl "http://www.syscon.net"
				}
			}
		}
	}


	def repositoryType = project.version.endsWith('-SNAPSHOT')? "snapshot": "release"
	publishing {
		publications {
			mavenJava(MavenPublication) {
				from components.java
			}
		}
		repositories {
			maven {
				credentials {
					username = "${artifactory_username}"
					password = "${artifactory_password}"
				}
				url "${artifactory_url}/libs-${repositoryType}-local"
			}
		}
	}

	sourceSets {
		integrationTest {
			java.srcDir file("src/integration-test/resources")
			resources.srcDir file("src/integration-test/resources")
			compileClasspath += sourceSets.main.output + sourceSets.test.output + configurations.integrationTestCompile
			runtimeClasspath += sourceSets.main.output + sourceSets.test.output + configurations.integrationTestRuntime
		}
	}

	task integrationTest(type: Test) {
		testClassesDir = sourceSets.integrationTest.output.classesDir
		classpath = sourceSets.integrationTest.runtimeClasspath
	}

}
